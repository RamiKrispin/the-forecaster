<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rami Krispin">
<meta name="dcterms.date" content="2025-12-15">

<title>Issue 1: Piecewise Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="issue_1_files/libs/clipboard/clipboard.min.js"></script>
<script src="issue_1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="issue_1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="issue_1_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="issue_1_files/libs/quarto-html/popper.min.js"></script>
<script src="issue_1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="issue_1_files/libs/quarto-html/anchor.min.js"></script>
<link href="issue_1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="issue_1_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="issue_1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="issue_1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="issue_1_files/libs/bootstrap/bootstrap-85c10ba73c7301af564f065c7ce6e7f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="issue_1_files/libs/htmltools-fill-0.5.9/fill.css" rel="stylesheet">
<script src="issue_1_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="issue_1_files/libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="issue_1_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="issue_1_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="issue_1_files/libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet">
<script src="issue_1_files/libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>
<link href="issue_1_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="issue_1_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#modeling-the-series-trend" id="toc-modeling-the-series-trend" class="nav-link active" data-scroll-target="#modeling-the-series-trend">Modeling the Series Trend</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Issue 1: Piecewise Regression</h1>
<p class="subtitle lead">with Linear Regression</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rami Krispin </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 15, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jtools)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert hex color to rgba format</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>hex_to_rgba <span class="ot">&lt;-</span> <span class="cf">function</span>(hex, <span class="at">opacity =</span> <span class="dv">1</span>) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the # if present</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  hex <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"#"</span>, <span class="st">""</span>, hex)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract RGB components</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">strtoi</span>(<span class="fu">substr</span>(hex, <span class="dv">1</span>, <span class="dv">2</span>), <span class="at">base =</span> <span class="dv">16</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">&lt;-</span> <span class="fu">strtoi</span>(<span class="fu">substr</span>(hex, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">base =</span> <span class="dv">16</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">strtoi</span>(<span class="fu">substr</span>(hex, <span class="dv">5</span>, <span class="dv">6</span>), <span class="at">base =</span> <span class="dv">16</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Validate opacity is between 0 and 1</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (opacity <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">||</span> opacity <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Opacity must be between 0 and 1"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return formatted rgba string</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">paste0</span>(<span class="st">"rgba("</span>, r, <span class="st">", "</span>, g, <span class="st">", "</span>, b, <span class="st">", "</span>, opacity, <span class="st">")"</span>))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create arc curve data for plotly add_lines</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>create_arc <span class="ot">&lt;-</span> <span class="cf">function</span>(x0, y0, x1, y1, <span class="at">curvature =</span> <span class="fl">0.2</span>, <span class="at">length.out =</span> <span class="dv">50</span>) {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate midpoint</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  mx <span class="ot">&lt;-</span> (x0 <span class="sc">+</span> x1) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  my <span class="ot">&lt;-</span> (y0 <span class="sc">+</span> y1) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ranges for scaling</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  x_range <span class="ot">&lt;-</span> <span class="fu">abs</span>(x1 <span class="sc">-</span> x0)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  y_range <span class="ot">&lt;-</span> <span class="fu">abs</span>(y1 <span class="sc">-</span> y0)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Handle vertical or horizontal lines</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x_range <span class="sc">==</span> <span class="dv">0</span>) x_range <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (y_range <span class="sc">==</span> <span class="dv">0</span>) y_range <span class="ot">&lt;-</span> <span class="fu">abs</span>(my) <span class="sc">*</span> <span class="fl">0.1</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Direction vector</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  dx <span class="ot">&lt;-</span> x1 <span class="sc">-</span> x0</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  dy <span class="ot">&lt;-</span> y1 <span class="sc">-</span> y0</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perpendicular offset: rotate 90 degrees and scale by curvature</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply curvature as a percentage of the respective range</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  cx <span class="ot">&lt;-</span> mx <span class="sc">-</span> <span class="fu">sign</span>(dy) <span class="sc">*</span> curvature <span class="sc">*</span> x_range</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  cy <span class="ot">&lt;-</span> my <span class="sc">+</span> <span class="fu">sign</span>(dx) <span class="sc">*</span> curvature <span class="sc">*</span> y_range</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate bezier curve points using quadratic bezier formula</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># B(t) = (1-t)^2 * P0 + 2*(1-t)*t * P1 + t^2 * P2</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> length.out)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> t)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> x0 <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> t) <span class="sc">*</span> t <span class="sc">*</span> cx <span class="sc">+</span> t<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> x1</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> t)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> y0 <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> t) <span class="sc">*</span> t <span class="sc">*</span> cy <span class="sc">+</span> t<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> y1</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return data frame ready for add_lines</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y))</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>legend_x <span class="ot">=</span> <span class="fl">0.03</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>legend_y <span class="ot">=</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">paste</span>(here<span class="sc">::</span><span class="fu">here</span>(),<span class="st">"data/ca_natural_gas_consumers.csv"</span>, <span class="at">sep =</span> <span class="st">"/"</span> )</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(path) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">arrange</span>(index) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(index <span class="sc">&gt;</span> <span class="dv">1986</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_tsibble</span>(<span class="at">index =</span> <span class="st">"index"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>ts <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 6 x 3 [1Y]
  index       y series_id
  &lt;int&gt;   &lt;int&gt; &lt;chr&gt;    
1  1987 7904858 SCA      
2  1988 8113034 SCA      
3  1989 8313776 SCA      
4  1990 8497848 SCA      
5  1991 8634774 SCA      
6  1992 8680613 SCA      </code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">data =</span> ts) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> index,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="sc">~</span> y, <span class="at">name =</span> <span class="st">"Actual"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">layout</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Number of Natural Gas Consumers in California"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Number of Consumers"</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Source: US energy information administration"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> legend_x, <span class="at">y =</span> legend_y)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-601f480c532b5201debf" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-601f480c532b5201debf">{"x":{"visdat":{"30633c2fba33":["function () ","plotlyVisDat"]},"cur_data":"30633c2fba33","attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Consumers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: US energy information administration"},"legend":{"x":0.029999999999999999,"y":1},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="modeling-the-series-trend" class="level2">
<h2 class="anchored" data-anchor-id="modeling-the-series-trend">Modeling the Series Trend</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ts<span class="sc">$</span>trend <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>md1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> trend, <span class="at">data =</span> ts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom function to create regression summary table with gt</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>gt_summ <span class="ot">&lt;-</span> <span class="cf">function</span>(model) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get summary statistics</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract model info</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  n_obs <span class="ot">&lt;-</span> <span class="fu">nobs</span>(model)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  dep_var <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">formula</span>(model)[[<span class="dv">2</span>]])</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract model fit statistics</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  fstat <span class="ot">&lt;-</span> s<span class="sc">$</span>fstatistic</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  f_value <span class="ot">&lt;-</span> fstat[<span class="dv">1</span>]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  df1 <span class="ot">&lt;-</span> fstat[<span class="dv">2</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  df2 <span class="ot">&lt;-</span> fstat[<span class="dv">3</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  f_pval <span class="ot">&lt;-</span> <span class="fu">pf</span>(f_value, df1, df2, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  r_squared <span class="ot">&lt;-</span> s<span class="sc">$</span>r.squared</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  adj_r_squared <span class="ot">&lt;-</span> s<span class="sc">$</span>adj.r.squared</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to add significance stars</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  get_stars <span class="ot">&lt;-</span> <span class="cf">function</span>(p_val) {</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (p_val <span class="sc">&lt;</span> <span class="fl">0.001</span>) <span class="fu">return</span>(<span class="st">"⭐⭐⭐"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (p_val <span class="sc">&lt;</span> <span class="fl">0.01</span>) <span class="fu">return</span>(<span class="st">"⭐⭐"</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (p_val <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="fu">return</span>(<span class="st">"⭐"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (p_val <span class="sc">&lt;</span> <span class="fl">0.1</span>) <span class="fu">return</span>(<span class="st">"."</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="fu">return</span>(<span class="st">""</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create coefficient table</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  coef_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(s<span class="sc">$</span>coefficients) <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">Est. =</span> Estimate,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">S.E. =</span> <span class="st">`</span><span class="at">Std. Error</span><span class="st">`</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">t val.</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">t value</span><span class="st">`</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">p =</span> <span class="st">`</span><span class="at">Pr(&gt;|t|)</span><span class="st">`</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_raw =</span> p,  <span class="co"># Keep raw p-value for star calculation</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">Est. =</span> <span class="fu">formatC</span>(Est., <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">S.E. =</span> <span class="fu">formatC</span>(S.E., <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>, <span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">t val.</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">formatC</span>(<span class="st">`</span><span class="at">t val.</span><span class="st">`</span>, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">stars =</span> <span class="fu">sapply</span>(p_raw, get_stars),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">p =</span> <span class="fu">paste0</span>(<span class="fu">formatC</span>(p, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">" "</span>, stars)</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>p_raw, <span class="sc">-</span>stars)</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create gt table</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  gt_table <span class="ot">&lt;-</span> coef_table <span class="sc">|&gt;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**MODEL SUMMARY**"</span>)</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_source_note</span>(</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">source_note =</span> <span class="fu">md</span>(<span class="fu">paste0</span>(</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"**MODEL INFO:**&lt;br&gt;"</span>,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Observations: "</span>, n_obs, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Dependent Variable: "</span>, dep_var, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Type: OLS linear regression&lt;br&gt;&lt;br&gt;"</span>,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">"**MODEL FIT:**&lt;br&gt;"</span>,</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">"F("</span>, df1, <span class="st">","</span>, df2, <span class="st">") = "</span>, <span class="fu">formatC</span>(f_value, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">", p = "</span>, <span class="fu">formatC</span>(f_pval, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"R² = "</span>, <span class="fu">formatC</span>(r_squared, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Adj. R² = "</span>, <span class="fu">formatC</span>(adj_r_squared, <span class="at">format =</span> <span class="st">"f"</span>, <span class="at">digits =</span> <span class="dv">3</span>), <span class="st">"&lt;br&gt;&lt;br&gt;"</span>,</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Standard errors: OLS&lt;br&gt;"</span>,</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Signif. codes: 0 ⭐⭐⭐ 0.001 ⭐⭐ 0.01 ⭐ 0.05 '.' 0.1 ' ' 1"</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_align</span>(</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"right"</span>,</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(Est., S.E., <span class="st">`</span><span class="at">t val.</span><span class="st">`</span>, p)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_align</span>(</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"left"</span>,</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> Variable</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_options</span>(</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">12</span>),</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">heading.align =</span> <span class="st">"left"</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gt_table)</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_summ</span>(md1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="aimtlsbqac" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#aimtlsbqac table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#aimtlsbqac thead, #aimtlsbqac tbody, #aimtlsbqac tfoot, #aimtlsbqac tr, #aimtlsbqac td, #aimtlsbqac th {
  border-style: none;
}

#aimtlsbqac p {
  margin: 0;
  padding: 0;
}

#aimtlsbqac .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#aimtlsbqac .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#aimtlsbqac .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#aimtlsbqac .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#aimtlsbqac .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aimtlsbqac .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aimtlsbqac .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#aimtlsbqac .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#aimtlsbqac .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#aimtlsbqac .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#aimtlsbqac .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#aimtlsbqac .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#aimtlsbqac .gt_spanner_row {
  border-bottom-style: hidden;
}

#aimtlsbqac .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#aimtlsbqac .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#aimtlsbqac .gt_from_md > :first-child {
  margin-top: 0;
}

#aimtlsbqac .gt_from_md > :last-child {
  margin-bottom: 0;
}

#aimtlsbqac .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#aimtlsbqac .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#aimtlsbqac .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#aimtlsbqac .gt_row_group_first td {
  border-top-width: 2px;
}

#aimtlsbqac .gt_row_group_first th {
  border-top-width: 2px;
}

#aimtlsbqac .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aimtlsbqac .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#aimtlsbqac .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#aimtlsbqac .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aimtlsbqac .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#aimtlsbqac .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#aimtlsbqac .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#aimtlsbqac .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#aimtlsbqac .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#aimtlsbqac .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aimtlsbqac .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aimtlsbqac .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#aimtlsbqac .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#aimtlsbqac .gt_left {
  text-align: left;
}

#aimtlsbqac .gt_center {
  text-align: center;
}

#aimtlsbqac .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#aimtlsbqac .gt_font_normal {
  font-weight: normal;
}

#aimtlsbqac .gt_font_bold {
  font-weight: bold;
}

#aimtlsbqac .gt_font_italic {
  font-style: italic;
}

#aimtlsbqac .gt_super {
  font-size: 65%;
}

#aimtlsbqac .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#aimtlsbqac .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#aimtlsbqac .gt_indent_1 {
  text-indent: 5px;
}

#aimtlsbqac .gt_indent_2 {
  text-indent: 10px;
}

#aimtlsbqac .gt_indent_3 {
  text-indent: 15px;
}

#aimtlsbqac .gt_indent_4 {
  text-indent: 20px;
}

#aimtlsbqac .gt_indent_5 {
  text-indent: 25px;
}

#aimtlsbqac .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#aimtlsbqac div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_heading header">
<td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>MODEL SUMMARY</strong></td>
</tr>
<tr class="gt_col_headings even">
<th id="Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Variable</th>
<th id="Est." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Est.</th>
<th id="S.E." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">S.E.</th>
<th id="t-val." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">t val.</th>
<th id="p" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">p</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">(Intercept)</td>
<td class="gt_row gt_right" headers="Est.">8,123,398.434</td>
<td class="gt_row gt_right" headers="S.E.">55,341.793</td>
<td class="gt_row gt_right" headers="t val.">146.786</td>
<td class="gt_row gt_right" headers="p">0.000 ⭐⭐⭐</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">trend</td>
<td class="gt_row gt_right" headers="Est.">94,013.643</td>
<td class="gt_row gt_right" headers="S.E.">2,473.724</td>
<td class="gt_row gt_right" headers="t val.">38.005</td>
<td class="gt_row gt_right" headers="p">0.000 ⭐⭐⭐</td>
</tr>
</tbody><tfoot>
<tr class="gt_sourcenotes odd">
<td colspan="5" class="gt_sourcenote"><strong>MODEL INFO:</strong><br>Observations: 38<br>Dependent Variable: y<br>Type: OLS linear regression<br><br><strong>MODEL FIT:</strong><br>F(1,36) = 1444.373, p = 0.000<br>R² = 0.976<br>Adj. R² = 0.975<br><br>Standard errors: OLS<br>Signif. codes: 0 ⭐⭐⭐ 0.001 ⭐⭐ 0.01 ⭐ 0.05 ‘.’ 0.1 ’ ’ 1</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(md1, <span class="at">newdata =</span> ts, <span class="at">interval =</span> <span class="st">"confidence"</span>) </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fit1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit1)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>fit1_df<span class="sc">$</span>index <span class="ot">&lt;-</span> ts<span class="sc">$</span>index</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>fit1_df <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      fit     lwr     upr index
1 8217412 8109519 8325306  1987
2 8311426 8207816 8415035  1988
3 8405439 8306046 8504833  1989
4 8499453 8404197 8594709  1990
5 8593467 8502260 8684673  1991
6 8687480 8600223 8774738  1992</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span>  p <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ribbons</span>(<span class="at">x =</span> fit1_df<span class="sc">$</span>index, <span class="at">ymin =</span> fit1_df<span class="sc">$</span>lwr, <span class="at">ymax =</span> fit1_df<span class="sc">$</span>upr,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgba(7, 164, 181, 0.05)'</span>),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillcolor =</span> <span class="st">'rgba(7, 164, 181, 0.2)'</span>, <span class="at">name =</span> <span class="st">"95% Confidence </span><span class="sc">\n</span><span class="st"> Interval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> fit1_df<span class="sc">$</span>index, <span class="at">y =</span> fit1_df<span class="sc">$</span>fit,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgba(7, 164, 181, 1)'</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Baseline Trend"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_segments</span>(<span class="at">x =</span> <span class="fu">min</span>(ts<span class="sc">$</span>index), <span class="at">xend =</span> <span class="fu">max</span>(ts<span class="sc">$</span>index),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y), <span class="at">yend =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>, <span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Avg(Y)"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_segments</span>(<span class="at">x =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index), <span class="at">xend =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index),</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">min</span>(ts<span class="sc">$</span>y), <span class="at">yend =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="fu">max</span>(ts<span class="sc">$</span>y), <span class="fu">max</span>(fit1_df<span class="sc">$</span>fit))),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>, <span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Avg(X)"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="fu">max</span>(ts<span class="sc">$</span>y), <span class="fu">max</span>(fit1_df<span class="sc">$</span>fit))) <span class="sc">*</span> <span class="fl">1.01</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"x̄"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">max</span>(ts<span class="sc">$</span>index) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y) <span class="sc">*</span> <span class="fl">1.005</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"ȳ"</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> legend_x, <span class="at">y =</span> legend_y))</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>p1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-301ba062ce2ef1c8bec9" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-301ba062ce2ef1c8bec9">{"x":{"visdat":{"30633c2fba33":["function () ","plotlyVisDat"]},"cur_data":"30633c2fba33","attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"30633c2fba33.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"ymin":[8109518.6138230329,8207816.4098027712,8306045.6087661013,8404197.1029819809,8502260.3159045428,8600222.9553944841,8698070.7377222944,8795787.0890758876,8893352.8396189492,8990745.9380038027,9087941.2327349521,9184910.391051868,9281622.0537164249,9378042.3481496032,9474135.8885985911,9569867.3592133019,9665203.682244882,9760116.6128923129,9854585.4062287491,9948599.0492969193,10042157.542096822,10135271.897585729,10227962.860690488,10320258.676212115,10412192.421899466,10503799.413602628,10595115.037074409,10686173.164893832,10777005.156299021,10867639.344050506,10958100.879643783,11048411.814426528,11138591.318235058,11228655.964881456,11318620.038095232,11408495.830015691,11498293.9171887,11588023.407345299],"ymax":[8325305.5400231229,8415035.0301797222,8504833.1173527315,8594708.9092731923,8684672.982486967,8774737.629133366,8864917.1329418961,8955228.0677246395,9045689.6033179183,9136323.7910694014,9227155.7824745923,9318213.9102940131,9409529.5337657966,9501136.5254689585,9593070.2711563073,9685366.0866779368,9778057.0497826934,9871171.4052716028,9964729.8980715033,10058743.541139673,10153212.334476111,10248125.265123541,10343461.588155122,10439193.058769831,10535286.599218821,10631706.893652,10728418.556316555,10825387.714633472,10922583.00936462,11019976.107749475,11117541.858292535,11215258.20964613,11313105.99197394,11411068.63146388,11509131.844386443,11607283.338602321,11705512.537565652,11803810.333545391],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(7, 164, 181, 0.05)"},"fillcolor":"rgba(7, 164, 181, 0.2)","name":"95% Confidence <br /> Interval","inherit":true},"30633c2fba33.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8217412.0769230779,8311425.7199912472,8405439.3630594164,8499453.0061275866,8593466.6491957549,8687480.2922639251,8781493.9353320953,8875507.5784002636,8969521.2214684337,9063534.8645366021,9157548.5076047722,9251562.1506729405,9345575.7937411107,9439589.4368092809,9533603.0798774492,9627616.7229456194,9721630.3660137877,9815644.0090819579,9909657.6521501262,10003671.295218296,10097684.938286467,10191698.581354635,10285712.224422805,10379725.867490973,10473739.510559143,10567753.153627314,10661766.796695482,10755780.439763652,10849794.08283182,10943807.725899991,11037821.368968159,11131835.012036329,11225848.655104499,11319862.298172668,11413875.941240838,11507889.584309006,11601903.227377176,11695916.870445345],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dash"},"name":"Baseline Trend","inherit":true},"30633c2fba33.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":1987,"y":9956664.4736842103,"xend":2024,"yend":9956664.4736842103,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(Y)","showlegend":false,"inherit":true},"30633c2fba33.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":2005.5,"y":7904858,"xend":2005.5,"yend":11695916.870445345,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(X)","showlegend":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Consumers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: US energy information administration"},"legend":{"x":0.029999999999999999,"y":1},"annotations":[{"text":"x̄","x":2005.5,"y":11812876.039149798,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"x̄","x":2005.5,"y":11812876.039149798,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"ȳ","x":2025,"y":10006447.796052631,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"ȳ","x":2025,"y":10006447.796052631,"showarrow":false,"font":{"size":14,"color":"black"}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(7, 164, 181, 0.2)","x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2024,2024,2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000,1999,1998,1997,1996,1995,1994,1993,1992,1991,1990,1989,1988,1987],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(7, 164, 181, 0.05)"},"name":"95% Confidence <br /> Interval","y":[8109518.6138230329,8207816.4098027712,8306045.6087661013,8404197.1029819809,8502260.3159045428,8600222.9553944841,8698070.7377222944,8795787.0890758876,8893352.8396189492,8990745.9380038027,9087941.2327349521,9184910.391051868,9281622.0537164249,9378042.3481496032,9474135.8885985911,9569867.3592133019,9665203.682244882,9760116.6128923129,9854585.4062287491,9948599.0492969193,10042157.542096822,10135271.897585729,10227962.860690488,10320258.676212115,10412192.421899466,10503799.413602628,10595115.037074409,10686173.164893832,10777005.156299021,10867639.344050506,10958100.879643783,11048411.814426528,11138591.318235058,11228655.964881456,11318620.038095232,11408495.830015691,11498293.9171887,11588023.407345299,11588023.407345299,11803810.333545391,11705512.537565652,11607283.338602321,11509131.844386443,11411068.63146388,11313105.99197394,11215258.20964613,11117541.858292535,11019976.107749475,10922583.00936462,10825387.714633472,10728418.556316555,10631706.893652,10535286.599218821,10439193.058769831,10343461.588155122,10248125.265123541,10153212.334476111,10058743.541139673,9964729.8980715033,9871171.4052716028,9778057.0497826934,9685366.0866779368,9593070.2711563073,9501136.5254689585,9409529.5337657966,9318213.9102940131,9227155.7824745923,9136323.7910694014,9045689.6033179183,8955228.0677246395,8864917.1329418961,8774737.629133366,8684672.982486967,8594708.9092731923,8504833.1173527315,8415035.0301797222,8325305.5400231229],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8217412.0769230779,8311425.7199912472,8405439.3630594164,8499453.0061275866,8593466.6491957549,8687480.2922639251,8781493.9353320953,8875507.5784002636,8969521.2214684337,9063534.8645366021,9157548.5076047722,9251562.1506729405,9345575.7937411107,9439589.4368092809,9533603.0798774492,9627616.7229456194,9721630.3660137877,9815644.0090819579,9909657.6521501262,10003671.295218296,10097684.938286467,10191698.581354635,10285712.224422805,10379725.867490973,10473739.510559143,10567753.153627314,10661766.796695482,10755780.439763652,10849794.08283182,10943807.725899991,11037821.368968159,11131835.012036329,11225848.655104499,11319862.298172668,11413875.941240838,11507889.584309006,11601903.227377176,11695916.870445345],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dash"},"name":"Baseline Trend","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,2024],"y":[9956664.4736842103,9956664.4736842103],"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(Y)","showlegend":false,"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2005.5,2005.5],"y":[7904858,11695916.870445345],"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(X)","showlegend":false,"marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>future_df <span class="ot">&lt;-</span> ts <span class="sc">|&gt;</span> <span class="fu">new_data</span>(h)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>trend_start <span class="ot">&lt;-</span> <span class="fu">max</span>(ts<span class="sc">$</span>trend) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>future_df<span class="sc">$</span>trend <span class="ot">&lt;-</span> trend_start<span class="sc">:</span>(trend_start <span class="sc">+</span> h <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>fc1 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(md1, <span class="at">newdata =</span> future_df, <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>fc1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fc1) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">index =</span> future_df<span class="sc">$</span>index)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>fc1_df <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr index
1 11789931 11432704 12147157  2025
2 11883944 11525312 12242577  2026
3 11977958 11617854 12338061  2027
4 12071971 11710334 12433609  2028
5 12165985 11802750 12529220  2029
6 12259999 11895104 12624893  2030</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ribbons</span>(<span class="at">x =</span> fc1_df<span class="sc">$</span>index, <span class="at">ymin =</span> fc1_df<span class="sc">$</span>lwr, <span class="at">ymax =</span> fc1_df<span class="sc">$</span>upr,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgba(7, 164, 181, 0.05)'</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillcolor =</span> <span class="st">'rgba(7, 164, 181, 0.2)'</span>, <span class="at">name =</span> <span class="st">"95% Predication </span><span class="sc">\n</span><span class="st"> Interval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> fc1_df<span class="sc">$</span>index, <span class="at">y =</span> fc1_df<span class="sc">$</span>fit,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgba(7, 164, 181, 1)'</span>, <span class="at">dash =</span> <span class="st">"dot"</span>), <span class="at">name =</span> <span class="st">"Forecast"</span>) <span class="sc">|&gt;</span><span class="fu">add_lines</span>(<span class="at">x =</span> fit1_df<span class="sc">$</span>index, <span class="at">y =</span> fit1_df<span class="sc">$</span>fit,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'rgba(7, 164, 181, 1)'</span>, <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Fitted Trend"</span>)<span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> legend_x, <span class="at">y =</span> legend_y))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-46322a9b0bd59e187f63" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-46322a9b0bd59e187f63">{"x":{"visdat":{"30633c2fba33":["function () ","plotlyVisDat"]},"cur_data":"30633c2fba33","attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"30633c2fba33.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"ymin":[11432704.362552909,11525311.59801279,11617854.424689284,11710333.628452022,11802750.015600279,11895104.411036698,11987397.656458126,12079630.60857084,12171804.137336943,12263919.124257999],"ymax":[12147156.66447412,12242576.71515058,12338061.174610423,12433609.256984025,12529220.155972105,12624893.046672026,12720627.087386938,12816421.421410561,12912275.178780798,13008187.477996079],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(7, 164, 181, 0.05)"},"fillcolor":"rgba(7, 164, 181, 0.2)","name":"95% Predication <br /> Interval","inherit":true},"30633c2fba33.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"y":[11789930.513513515,11883944.156581685,11977957.799649853,12071971.442718023,12165985.085786192,12259998.728854362,12354012.371922532,12448026.0149907,12542039.658058871,12636053.301127039],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dot"},"name":"Forecast","inherit":true},"30633c2fba33.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8217412.0769230779,8311425.7199912472,8405439.3630594164,8499453.0061275866,8593466.6491957549,8687480.2922639251,8781493.9353320953,8875507.5784002636,8969521.2214684337,9063534.8645366021,9157548.5076047722,9251562.1506729405,9345575.7937411107,9439589.4368092809,9533603.0798774492,9627616.7229456194,9721630.3660137877,9815644.0090819579,9909657.6521501262,10003671.295218296,10097684.938286467,10191698.581354635,10285712.224422805,10379725.867490973,10473739.510559143,10567753.153627314,10661766.796695482,10755780.439763652,10849794.08283182,10943807.725899991,11037821.368968159,11131835.012036329,11225848.655104499,11319862.298172668,11413875.941240838,11507889.584309006,11601903.227377176,11695916.870445345],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dash"},"name":"Fitted Trend","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Consumers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: US energy information administration"},"legend":{"x":0.029999999999999999,"y":1},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(7, 164, 181, 0.2)","x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2034,2034,2033,2032,2031,2030,2029,2028,2027,2026,2025],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(7, 164, 181, 0.05)"},"name":"95% Predication <br /> Interval","y":[11432704.362552909,11525311.59801279,11617854.424689284,11710333.628452022,11802750.015600279,11895104.411036698,11987397.656458126,12079630.60857084,12171804.137336943,12263919.124257999,12263919.124257999,13008187.477996079,12912275.178780798,12816421.421410561,12720627.087386938,12624893.046672026,12529220.155972105,12433609.256984025,12338061.174610423,12242576.71515058,12147156.66447412],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"y":[11789930.513513515,11883944.156581685,11977957.799649853,12071971.442718023,12165985.085786192,12259998.728854362,12354012.371922532,12448026.0149907,12542039.658058871,12636053.301127039],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dot"},"name":"Forecast","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8217412.0769230779,8311425.7199912472,8405439.3630594164,8499453.0061275866,8593466.6491957549,8687480.2922639251,8781493.9353320953,8875507.5784002636,8969521.2214684337,9063534.8645366021,9157548.5076047722,9251562.1506729405,9345575.7937411107,9439589.4368092809,9533603.0798774492,9627616.7229456194,9721630.3660137877,9815644.0090819579,9909657.6521501262,10003671.295218296,10097684.938286467,10191698.581354635,10285712.224422805,10379725.867490973,10473739.510559143,10567753.153627314,10661766.796695482,10755780.439763652,10849794.08283182,10943807.725899991,11037821.368968159,11131835.012036329,11225848.655104499,11319862.298172668,11413875.941240838,11507889.584309006,11601903.227377176,11695916.870445345],"type":"scatter","mode":"lines","line":{"color":"rgba(7, 164, 181, 1)","dash":"dash"},"name":"Fitted Trend","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> ts<span class="sc">$</span>trend[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2008</span>)]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ts<span class="sc">$</span>knot <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, ts<span class="sc">$</span>trend <span class="sc">-</span> s)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>md2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> trend <span class="sc">+</span> knot, <span class="at">data =</span> ts)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">gt_summ</span>(md2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="wuodqfctym" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wuodqfctym table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wuodqfctym thead, #wuodqfctym tbody, #wuodqfctym tfoot, #wuodqfctym tr, #wuodqfctym td, #wuodqfctym th {
  border-style: none;
}

#wuodqfctym p {
  margin: 0;
  padding: 0;
}

#wuodqfctym .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 12px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wuodqfctym .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wuodqfctym .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wuodqfctym .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wuodqfctym .gt_heading {
  background-color: #FFFFFF;
  text-align: left;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wuodqfctym .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wuodqfctym .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wuodqfctym .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wuodqfctym .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wuodqfctym .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wuodqfctym .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wuodqfctym .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wuodqfctym .gt_spanner_row {
  border-bottom-style: hidden;
}

#wuodqfctym .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wuodqfctym .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wuodqfctym .gt_from_md > :first-child {
  margin-top: 0;
}

#wuodqfctym .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wuodqfctym .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wuodqfctym .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wuodqfctym .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wuodqfctym .gt_row_group_first td {
  border-top-width: 2px;
}

#wuodqfctym .gt_row_group_first th {
  border-top-width: 2px;
}

#wuodqfctym .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wuodqfctym .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wuodqfctym .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wuodqfctym .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wuodqfctym .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wuodqfctym .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wuodqfctym .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wuodqfctym .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wuodqfctym .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wuodqfctym .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wuodqfctym .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wuodqfctym .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wuodqfctym .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wuodqfctym .gt_left {
  text-align: left;
}

#wuodqfctym .gt_center {
  text-align: center;
}

#wuodqfctym .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wuodqfctym .gt_font_normal {
  font-weight: normal;
}

#wuodqfctym .gt_font_bold {
  font-weight: bold;
}

#wuodqfctym .gt_font_italic {
  font-style: italic;
}

#wuodqfctym .gt_super {
  font-size: 65%;
}

#wuodqfctym .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wuodqfctym .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wuodqfctym .gt_indent_1 {
  text-indent: 5px;
}

#wuodqfctym .gt_indent_2 {
  text-indent: 10px;
}

#wuodqfctym .gt_indent_3 {
  text-indent: 15px;
}

#wuodqfctym .gt_indent_4 {
  text-indent: 20px;
}

#wuodqfctym .gt_indent_5 {
  text-indent: 25px;
}

#wuodqfctym .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wuodqfctym div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_heading header">
<td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>MODEL SUMMARY</strong></td>
</tr>
<tr class="gt_col_headings even">
<th id="Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Variable</th>
<th id="Est." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Est.</th>
<th id="S.E." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">S.E.</th>
<th id="t-val." class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">t val.</th>
<th id="p" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">p</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">(Intercept)</td>
<td class="gt_row gt_right" headers="Est.">7,888,957.373</td>
<td class="gt_row gt_right" headers="S.E.">30,324.148</td>
<td class="gt_row gt_right" headers="t val.">260.154</td>
<td class="gt_row gt_right" headers="p">0.000 ⭐⭐⭐</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Variable">trend</td>
<td class="gt_row gt_right" headers="Est.">116,146.191</td>
<td class="gt_row gt_right" headers="S.E.">2,060.036</td>
<td class="gt_row gt_right" headers="t val.">56.381</td>
<td class="gt_row gt_right" headers="p">0.000 ⭐⭐⭐</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">knot</td>
<td class="gt_row gt_right" headers="Est.">-55,084.247</td>
<td class="gt_row gt_right" headers="S.E.">4,383.358</td>
<td class="gt_row gt_right" headers="t val.">-12.567</td>
<td class="gt_row gt_right" headers="p">0.000 ⭐⭐⭐</td>
</tr>
</tbody><tfoot>
<tr class="gt_sourcenotes odd">
<td colspan="5" class="gt_sourcenote"><strong>MODEL INFO:</strong><br>Observations: 38<br>Dependent Variable: y<br>Type: OLS linear regression<br><br><strong>MODEL FIT:</strong><br>F(2,35) = 3949.106, p = 0.000<br>R² = 0.996<br>Adj. R² = 0.995<br><br>Standard errors: OLS<br>Signif. codes: 0 ⭐⭐⭐ 0.001 ⭐⭐ 0.01 ⭐ 0.05 ‘.’ 0.1 ’ ’ 1</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>p_trend <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(ts) <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> index, <span class="at">y =</span> <span class="sc">~</span> trend, <span class="at">name =</span> <span class="st">"Trend"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Trend Feature"</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>p_knot <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(ts) <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">add_lines</span>(<span class="at">x =</span> <span class="sc">~</span> index, <span class="at">y =</span> <span class="sc">~</span> knot, <span class="at">name =</span> <span class="st">"Knot"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Knot Feature"</span>))</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">subplot</span>(p, p_trend, p_knot, <span class="at">nrows =</span> <span class="dv">3</span>,<span class="at">titleY =</span> <span class="cn">TRUE</span>, <span class="at">shareX=</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Year"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b4059ed634ce23702522" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b4059ed634ce23702522">{"x":{"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],"type":"scatter","mode":"lines","name":"Trend","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y2","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"type":"scatter","mode":"lines","name":"Knot","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"line":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y3","frame":null}],"layout":{"xaxis":{"domain":[0,1],"automargin":true,"title":"Year","anchor":"y3"},"yaxis3":{"domain":[0,0.31333333333333335],"automargin":true,"title":"Knot Feature","anchor":"x"},"yaxis2":{"domain":[0.35333333333333339,0.64666666666666672],"automargin":true,"title":"Trend Feature","anchor":"x"},"yaxis":{"domain":[0.68666666666666676,1],"automargin":true,"title":"Number of Consumers","anchor":"x"},"annotations":[],"shapes":[],"images":[],"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","legend":{"x":0.029999999999999999,"y":1},"hovermode":"closest","showlegend":true},"attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"30632df96e38":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Trend","inherit":true},"30631270e4f6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Knot","inherit":true}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"subplot":true,"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(md2, <span class="at">newdata =</span> ts, <span class="at">interval =</span> <span class="st">"confidence"</span>) </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fit2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit2)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>fit2_df<span class="sc">$</span>index <span class="ot">&lt;-</span> ts<span class="sc">$</span>index</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>fit2_df <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      fit     lwr     upr index
1 8005104 7947199 8063008  1987
2 8121250 8066926 8175573  1988
3 8237396 8186562 8288230  1989
4 8353542 8306085 8400999  1990
5 8469688 8425471 8513906  1991
6 8585835 8544686 8626983  1992</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit_color <span class="ot">&lt;-</span> <span class="st">"#F39EB6"</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span>  p <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ribbons</span>(<span class="at">x =</span> fit2_df<span class="sc">$</span>index, <span class="at">ymin =</span> fit2_df<span class="sc">$</span>lwr, <span class="at">ymax =</span> fit2_df<span class="sc">$</span>upr,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="fl">0.05</span>)),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillcolor =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="fl">0.2</span>), <span class="at">name =</span> <span class="st">"95% Confidence </span><span class="sc">\n</span><span class="st"> Interval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> fit2_df<span class="sc">$</span>index, <span class="at">y =</span> fit2_df<span class="sc">$</span>fit,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="dv">1</span>), <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Baseline Trend"</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_segments</span>(<span class="at">x =</span> <span class="fu">min</span>(ts<span class="sc">$</span>index), <span class="at">xend =</span> <span class="fu">max</span>(ts<span class="sc">$</span>index),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y), <span class="at">yend =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>, <span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Avg(Y)"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_segments</span>(<span class="at">x =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index), <span class="at">xend =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">min</span>(ts<span class="sc">$</span>y), <span class="at">yend =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="fu">max</span>(ts<span class="sc">$</span>y), <span class="fu">max</span>(fit2_df<span class="sc">$</span>fit))),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">dash =</span> <span class="st">"dash"</span>, <span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Avg(X)"</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>index),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="fu">max</span>(ts<span class="sc">$</span>y), <span class="fu">max</span>(fit2_df<span class="sc">$</span>fit))) <span class="sc">*</span> <span class="fl">1.01</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"x̄"</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">max</span>(ts<span class="sc">$</span>index) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">mean</span>(ts<span class="sc">$</span>y) <span class="sc">*</span> <span class="fl">1.005</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"ȳ"</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> legend_x, <span class="at">y =</span> legend_y))</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>p2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-f3d8cc627465f9ba86d0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-f3d8cc627465f9ba86d0">{"x":{"visdat":{"30633c2fba33":["function () ","plotlyVisDat"]},"cur_data":"30633c2fba33","attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"30633c2fba33.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"ymin":[7947199.1853080681,8066926.4539042395,8186561.8545781253,8306085.1196253849,8425470.5489471834,8544685.5784333367,8663689.2164978553,8782430.6619906984,8900848.7846072447,9018873.6492107529,9136431.6136483755,9253455.0091556963,9369895.222718576,9485734.6741555091,9600991.6887619924,9715715.4245314077,9829973.8070518188,9943840.4840059821,10057385.24096716,10170668.994499592,10283742.326874461,10396646.034465371,10461862.634827556,10526678.866785396,10590970.5987793,10654587.290124224,10717367.440635145,10779173.298626952,10839936.134729343,10899684.311283486,10958531.256384248,11016633.587067328,11074149.527222902,11131215.368601702,11187938.827424845,11244401.400656151,11300663.619091181,11356770.26831618],"ymax":[8063007.9416981703,8175573.0547004137,8288230.0356249427,8400999.1521760989,8513906.1044527162,8626983.4565649759,8740272.2000988703,8853823.1362044439,8967697.3951863144,9081964.9121812191,9196699.3293420095,9311968.3154331055,9427820.4834686425,9544273.4136301223,9661308.780622052,9778877.4264510535,9896911.425529059,10015337.130173309,10134084.754810544,10253093.382876528,10372312.432100076,10491701.10610758,10548608.394035554,10605916.050367873,10663748.206664132,10722255.403609363,10781599.141388603,10841917.171686955,10903278.223874727,10965653.93561074,11028930.878800137,11092952.43640722,11157560.384541806,11222618.431453165,11288018.860920178,11353680.175979035,11419541.845834164,11485559.084899325],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(243, 158, 182, 0.05)"},"fillcolor":"rgba(243, 158, 182, 0.2)","name":"95% Confidence <br /> Interval","inherit":true},"30633c2fba33.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8005103.5635031192,8121249.7543023266,8237395.945101534,8353542.1359007414,8469688.3266999498,8585834.5174991563,8701980.7082983628,8818126.8990975711,8934273.0898967795,9050419.280695986,9166565.4714951925,9282711.6622944009,9398857.8530936092,9515004.0438928157,9631150.2346920222,9747296.4254912306,9863442.6162904389,9979588.8070896454,10095734.997888852,10211881.18868806,10328027.379487269,10444173.570286475,10505235.514431555,10566297.458576635,10627359.402721716,10688421.346866794,10749483.291011874,10810545.235156953,10871607.179302035,10932669.123447113,10993731.067592192,11054793.011737274,11115854.955882354,11176916.900027433,11237978.844172511,11299040.788317593,11360102.732462673,11421164.676607752],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dash"},"name":"Baseline Trend","inherit":true},"30633c2fba33.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":1987,"y":9956664.4736842103,"xend":2024,"yend":9956664.4736842103,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(Y)","showlegend":false,"inherit":true},"30633c2fba33.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":2005.5,"y":7904858,"xend":2005.5,"yend":11428636,"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(X)","showlegend":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Consumers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: US energy information administration"},"legend":{"x":0.029999999999999999,"y":1},"annotations":[{"text":"x̄","x":2005.5,"y":11542922.359999999,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"x̄","x":2005.5,"y":11542922.359999999,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"ȳ","x":2025,"y":10006447.796052631,"showarrow":false,"font":{"size":14,"color":"black"}},{"text":"ȳ","x":2025,"y":10006447.796052631,"showarrow":false,"font":{"size":14,"color":"black"}}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(243, 158, 182, 0.2)","x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024,2024,2024,2023,2022,2021,2020,2019,2018,2017,2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006,2005,2004,2003,2002,2001,2000,1999,1998,1997,1996,1995,1994,1993,1992,1991,1990,1989,1988,1987],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(243, 158, 182, 0.05)"},"name":"95% Confidence <br /> Interval","y":[7947199.1853080681,8066926.4539042395,8186561.8545781253,8306085.1196253849,8425470.5489471834,8544685.5784333367,8663689.2164978553,8782430.6619906984,8900848.7846072447,9018873.6492107529,9136431.6136483755,9253455.0091556963,9369895.222718576,9485734.6741555091,9600991.6887619924,9715715.4245314077,9829973.8070518188,9943840.4840059821,10057385.24096716,10170668.994499592,10283742.326874461,10396646.034465371,10461862.634827556,10526678.866785396,10590970.5987793,10654587.290124224,10717367.440635145,10779173.298626952,10839936.134729343,10899684.311283486,10958531.256384248,11016633.587067328,11074149.527222902,11131215.368601702,11187938.827424845,11244401.400656151,11300663.619091181,11356770.26831618,11356770.26831618,11485559.084899325,11419541.845834164,11353680.175979035,11288018.860920178,11222618.431453165,11157560.384541806,11092952.43640722,11028930.878800137,10965653.93561074,10903278.223874727,10841917.171686955,10781599.141388603,10722255.403609363,10663748.206664132,10605916.050367873,10548608.394035554,10491701.10610758,10372312.432100076,10253093.382876528,10134084.754810544,10015337.130173309,9896911.425529059,9778877.4264510535,9661308.780622052,9544273.4136301223,9427820.4834686425,9311968.3154331055,9196699.3293420095,9081964.9121812191,8967697.3951863144,8853823.1362044439,8740272.2000988703,8626983.4565649759,8513906.1044527162,8400999.1521760989,8288230.0356249427,8175573.0547004137,8063007.9416981703],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8005103.5635031192,8121249.7543023266,8237395.945101534,8353542.1359007414,8469688.3266999498,8585834.5174991563,8701980.7082983628,8818126.8990975711,8934273.0898967795,9050419.280695986,9166565.4714951925,9282711.6622944009,9398857.8530936092,9515004.0438928157,9631150.2346920222,9747296.4254912306,9863442.6162904389,9979588.8070896454,10095734.997888852,10211881.18868806,10328027.379487269,10444173.570286475,10505235.514431555,10566297.458576635,10627359.402721716,10688421.346866794,10749483.291011874,10810545.235156953,10871607.179302035,10932669.123447113,10993731.067592192,11054793.011737274,11115854.955882354,11176916.900027433,11237978.844172511,11299040.788317593,11360102.732462673,11421164.676607752],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dash"},"name":"Baseline Trend","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,2024],"y":[9956664.4736842103,9956664.4736842103],"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(Y)","showlegend":false,"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2005.5,2005.5],"y":[7904858,11428636],"type":"scatter","mode":"lines","line":{"color":"black","dash":"dash","width":0.5},"name":"Avg(X)","showlegend":false,"marker":{"color":"rgba(148,103,189,1)","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>knot_start <span class="ot">&lt;-</span> <span class="fu">max</span>(ts<span class="sc">$</span>knot) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>future_df<span class="sc">$</span>knot <span class="ot">&lt;-</span> knot_start<span class="sc">:</span>(knot_start <span class="sc">+</span> h <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>fc2 <span class="ot">&lt;-</span> <span class="fu">predict.lm</span>(md2, <span class="at">newdata =</span> future_df, <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>fc2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fc2) <span class="sc">|&gt;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">index =</span> future_df<span class="sc">$</span>index)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>fc2_df <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr index
1 11482227 11319958 11644495  2025
2 11543289 11378738 11707839  2026
3 11604351 11437352 11771349  2027
4 11665412 11495805 11835020  2028
5 11726474 11554107 11898842  2029
6 11787536 11612263 11962810  2030</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>arc1 <span class="ot">&lt;-</span> <span class="fu">create_arc</span>(<span class="at">x0 =</span> <span class="fl">2003.7</span>, <span class="at">y0 =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2003</span>)] <span class="sc">*</span> <span class="fl">1.14</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x1 =</span> <span class="dv">2008</span>, <span class="at">y1 =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2008</span>)],</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">curvature =</span> <span class="fl">0.3</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>arc2 <span class="ot">&lt;-</span> <span class="fu">create_arc</span>(<span class="at">x0 =</span> <span class="fl">1995.7</span>, <span class="at">y0 =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">1995</span>)] <span class="sc">*</span> <span class="fl">1.14</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x1 =</span> <span class="dv">2000</span>, <span class="at">y1 =</span> fit2_df<span class="sc">$</span>fit[<span class="fu">which</span>(fit2_df<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2000</span>)],</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">curvature =</span> <span class="fl">0.4</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>arc3 <span class="ot">&lt;-</span> <span class="fu">create_arc</span>(<span class="at">x0 =</span> <span class="dv">2020</span>, <span class="at">y0 =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2020</span>)] <span class="sc">*</span> <span class="fl">0.92</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x1 =</span> <span class="dv">2015</span>, <span class="at">y1 =</span> fit2_df<span class="sc">$</span>fit[<span class="fu">which</span>(fit2_df<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2015</span>)],</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.4</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>p <span class="sc">|&gt;</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="fu">add_ribbons</span>(<span class="at">x =</span> fc2_df<span class="sc">$</span>index, <span class="at">ymin =</span> fc2_df<span class="sc">$</span>lwr, <span class="at">ymax =</span> fc2_df<span class="sc">$</span>upr,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="fl">0.05</span>)),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillcolor =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="fl">0.2</span>), <span class="at">name =</span> <span class="st">"95% Predication </span><span class="sc">\n</span><span class="st"> Interval"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> fc2_df<span class="sc">$</span>index, <span class="at">y =</span> fc2_df<span class="sc">$</span>fit,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="dv">1</span>), <span class="at">dash =</span> <span class="st">"dot"</span>), <span class="at">name =</span> <span class="st">"Forecast"</span>) <span class="sc">|&gt;</span><span class="fu">add_lines</span>(<span class="at">x =</span> fit2_df<span class="sc">$</span>index, <span class="at">y =</span> fit2_df<span class="sc">$</span>fit,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="fu">hex_to_rgba</span>(fit_color, <span class="dv">1</span>), <span class="at">dash =</span> <span class="st">"dash"</span>), <span class="at">name =</span> <span class="st">"Fitted Trend"</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_markers</span>(<span class="at">x =</span> <span class="dv">2008</span>, <span class="at">y =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2008</span>)], <span class="at">showlegend =</span> <span class="cn">FALSE</span>, <span class="at">name =</span> <span class="st">"Breaking Point"</span>, <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">legend =</span> <span class="fu">list</span>(<span class="at">x =</span> legend_x, <span class="at">y =</span> legend_y)) <span class="sc">|&gt;</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(<span class="at">text =</span> <span class="st">"Breaking </span><span class="sc">\n</span><span class="st"> Point"</span>, <span class="at">y_ref =</span> <span class="st">"y"</span>, <span class="at">x_ref =</span> <span class="st">"x"</span>, <span class="at">x =</span> <span class="dv">2002</span>, <span class="at">y =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2002</span>)] <span class="sc">*</span> <span class="fl">1.15</span> , <span class="at">showarrow =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> arc1<span class="sc">$</span>x, <span class="at">y =</span> arc1<span class="sc">$</span>y, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">""</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(<span class="at">text =</span> <span class="st">"Trend Segment I"</span>, <span class="at">y_ref =</span> <span class="st">"y"</span>, <span class="at">x_ref =</span> <span class="st">"x"</span>, <span class="at">x =</span> <span class="dv">1995</span>, <span class="at">y =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">1995</span>)] <span class="sc">*</span> <span class="fl">1.15</span> , <span class="at">showarrow =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> arc2<span class="sc">$</span>x, <span class="at">y =</span> arc2<span class="sc">$</span>y, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">""</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotations</span>(<span class="at">text =</span> <span class="st">"Trend Segment II"</span>, <span class="at">y_ref =</span> <span class="st">"y"</span>, <span class="at">x_ref =</span> <span class="st">"x"</span>, <span class="at">x =</span> <span class="dv">2021</span>, <span class="at">y =</span> ts<span class="sc">$</span>y[<span class="fu">which</span>(ts<span class="sc">$</span>index <span class="sc">==</span> <span class="dv">2021</span>)] <span class="sc">*</span> <span class="fl">0.9</span> , <span class="at">showarrow =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_lines</span>(<span class="at">x =</span> arc3<span class="sc">$</span>x, <span class="at">y =</span> arc3<span class="sc">$</span>y, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">width =</span> <span class="fl">0.9</span>),</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">""</span>, <span class="at">showlegend =</span> <span class="cn">FALSE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-235f67847e04a16f59d6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-235f67847e04a16f59d6">{"x":{"visdat":{"30633c2fba33":["function () ","plotlyVisDat"]},"cur_data":"30633c2fba33","attrs":{"30633c2fba33":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines","name":"Actual","inherit":true},"30633c2fba33.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"ymin":[11319958.450164588,11378738.381003117,11437351.548088063,11495805.174432991,11554106.502527181,11612262.72846292,11670280.945508838,11728168.096996685,11785930.938090432,11843576.005793301],"ymax":[11644494.791341076,11707838.748792706,11771349.469997924,11835019.731943151,11898842.29213912,11962809.954493541,12026915.625737786,12091152.362540098,12155513.409736507,12219992.230323801],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(243, 158, 182, 0.05)"},"fillcolor":"rgba(243, 158, 182, 0.2)","name":"95% Predication <br /> Interval","inherit":true},"30633c2fba33.2":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"y":[11482226.620752832,11543288.564897912,11604350.509042993,11665412.453188071,11726474.397333151,11787536.34147823,11848598.285623312,11909660.229768392,11970722.17391347,12031784.118058551],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dot"},"name":"Forecast","inherit":true},"30633c2fba33.3":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8005103.5635031192,8121249.7543023266,8237395.945101534,8353542.1359007414,8469688.3266999498,8585834.5174991563,8701980.7082983628,8818126.8990975711,8934273.0898967795,9050419.280695986,9166565.4714951925,9282711.6622944009,9398857.8530936092,9515004.0438928157,9631150.2346920222,9747296.4254912306,9863442.6162904389,9979588.8070896454,10095734.997888852,10211881.18868806,10328027.379487269,10444173.570286475,10505235.514431555,10566297.458576635,10627359.402721716,10688421.346866794,10749483.291011874,10810545.235156953,10871607.179302035,10932669.123447113,10993731.067592192,11054793.011737274,11115854.955882354,11176916.900027433,11237978.844172511,11299040.788317593,11360102.732462673,11421164.676607752],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dash"},"name":"Fitted Trend","inherit":true},"30633c2fba33.4":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":2008,"y":10515162,"type":"scatter","mode":"markers","showlegend":false,"name":"Breaking Point","marker":{"color":"red"},"inherit":true},"30633c2fba33.5":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2003.7,2003.7692317110505,2003.8379369452095,2003.9061157024794,2003.9737679828588,2004.0408937863485,2004.1074931129479,2004.1735659626568,2004.2391123354762,2004.3041322314048,2004.3686256504438,2004.4325925925925,2004.496033057851,2004.5589470462203,2004.621334557698,2004.6831955922867,2004.7445301499845,2004.8053382307928,2004.8656198347105,2004.9253749617387,2004.9846036118763,2005.0433057851239,2005.1014814814816,2005.1591307009489,2005.2162534435261,2005.272849709213,2005.3289194980102,2005.3844628099175,2005.4394796449342,2005.4939700030607,2005.5479338842979,2005.601371288644,2005.6542822161,2005.7066666666667,2005.758524640343,2005.8098561371287,2005.8606611570247,2005.9109397000309,2005.9606917661463,2006.0099173553715,2006.0586164677072,2006.1067891031528,2006.1544352617079,2006.2015549433731,2006.2481481481484,2006.2942148760333,2006.3397551270275,2006.3847689011327,2006.429256198347,2006.4732170186714,2006.5166513621061,2006.55955922865,2006.6019406183041,2006.643795531068,2006.685123966942,2006.7259259259258,2006.7662014080197,2006.8059504132229,2006.8451729415365,2006.8838689929598,2006.922038567493,2006.959681665136,2006.9967982858893,2007.033388429752,2007.0694520967247,2007.1049892868073,2007.1399999999999,2007.1744842363025,2007.2084419957146,2007.2418732782369,2007.274778083869,2007.307156412611,2007.3390082644628,2007.3703336394244,2007.4011325374961,2007.4314049586778,2007.4611509029692,2007.4903703703703,2007.5190633608813,2007.5472298745026,2007.5748699112337,2007.6019834710744,2007.6285705540254,2007.6546311600857,2007.6801652892561,2007.7051729415366,2007.7296541169269,2007.753608815427,2007.777037037037,2007.799938781757,2007.8223140495868,2007.8441628405267,2007.8654851545762,2007.8862809917355,2007.9065503520048,2007.9262932353843,2007.9455096418733,2007.9641995714724,2007.9823630241813,2008],"y":[11175774.539999999,11173064.956885217,11170274.490692377,11167403.141421488,11164450.909072543,11161417.793645546,11158303.795140496,11155108.913557392,11151833.148896234,11148476.501157023,11145038.970339762,11141520.556444444,11137921.259471072,11134241.079419652,11130480.016290173,11126638.070082644,11122715.24079706,11118711.528433423,11114626.932991734,11110461.454471992,11106215.092874195,11101887.848198345,11097479.720444445,11092990.709612485,11088420.815702477,11083770.038714414,11079038.378648302,11074225.835504133,11069332.409281909,11064358.099981634,11059302.907603307,11054166.832146924,11048949.873612488,11043652.032,11038273.307309458,11032813.699540863,11027273.208694216,11021651.834769513,11015949.577766757,11010166.43768595,11004302.414527088,10998357.508290175,10992331.718975207,10986225.046582185,10980037.491111111,10973769.052561982,10967419.730934802,10960989.526229568,10954478.43844628,10947886.467584938,10941213.613645546,10934459.876628099,10927625.256532598,10920709.753359044,10913713.367107438,10906636.097777778,10899477.945370063,10892238.909884298,10884918.991320476,10877518.189678604,10870036.504958676,10862473.937160697,10854830.486284664,10847106.152330577,10839300.935298439,10831414.835188245,10823447.852,10815399.985733703,10807271.236389346,10799061.603966942,10790771.088466484,10782399.689887971,10773947.408231404,10765414.243496787,10756800.195684113,10748105.264793389,10739329.450824611,10730472.753777778,10721535.173652891,10712516.710449953,10703417.364168962,10694237.134809919,10684976.022372819,10675634.026857667,10666211.148264462,10656707.386593204,10647122.741843894,10637457.214016527,10627710.80311111,10617883.509127639,10607975.332066115,10597986.271926539,10587916.328708908,10577765.502413223,10567533.793039486,10557221.200587695,10546827.725057852,10536353.366449954,10525798.124764005,10515162],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"inherit":true},"30633c2fba33.6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[1995.7,1995.8565264473136,1996.0101874219074,1996.1609829237821,1996.3089129529362,1996.4539775093713,1996.5961765930861,1996.7355102040819,1996.8719783423576,1997.0055810079134,1997.1363182007497,1997.2641899208661,1997.389196168263,1997.5113369429403,1997.630612244898,1997.7470220741359,1997.8605664306542,1997.9712453144525,1998.0790587255308,1998.1840066638899,1998.286089129529,1998.3853061224488,1998.481657642649,1998.5751436901289,1998.6657642648897,1998.7535193669305,1998.8384089962515,1998.9204331528529,1998.9995918367347,1999.0758850478967,1999.1493127863389,1999.2198750520615,1999.2875718450646,1999.3524031653478,1999.4143690129113,1999.4734693877551,1999.5297042898792,1999.5830737192837,1999.6335776759684,1999.6812161599332,1999.7259891711788,1999.7678967097042,1999.8069387755104,1999.8431153685963,1999.876426488963,1999.9068721366098,1999.9344523115369,1999.9591670137443,1999.981016243232,2000],"y":[10106716.739999998,10104104.430721056,10101097.810607558,10097696.879659506,10093901.637876894,10089712.085259726,10085128.221808,10080150.047521718,10074777.562400877,10069010.76644548,10062849.659655524,10056294.242031014,10049344.513571946,10042000.474278321,10034262.124150138,10026129.4631874,10017602.491390103,10008681.208758252,9999365.6152918395,9989655.7109908722,9979551.4958553463,9969052.9698852655,9958160.1330806278,9946872.9854414314,9935191.5269676801,9923115.7576593701,9910645.6775165014,9897781.2865390778,9884522.5847270973,9870869.57208056,9856822.2485994622,9842380.6142838113,9827544.6691336036,9812314.4131488372,9796689.8463295139,9780670.968675632,9764257.7801871952,9747450.2808642015,9730248.4707066491,9712652.3497145399,9694661.9178878739,9676277.1752266511,9657498.1217308715,9638324.757400535,9618757.0822356418,9598795.0962361898,9578438.7994021829,9557688.1917336173,9536543.2732304949,9515004.0438928157],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"inherit":true},"30633c2fba33.7":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2020,2019.9894908682791,2019.9781654933167,2019.9660238751148,2019.953066013672,2019.9392919089889,2019.9247015610654,2019.9092949699011,2019.8930721354966,2019.8760330578511,2019.8581777369659,2019.8395061728393,2019.8200183654728,2019.7997143148662,2019.7785940210181,2019.7566574839304,2019.7339047036014,2019.7103356800324,2019.6859504132228,2019.6607489031733,2019.6347311498828,2019.6078971533516,2019.5802469135804,2019.551780430568,2019.5224977043158,2019.4923987348227,2019.4614835220896,2019.4297520661157,2019.3972043669014,2019.3638404244462,2019.3296602387513,2019.2946638098153,2019.2588511376389,2019.2222222222224,2019.1847770635652,2019.1465156616673,2019.1074380165287,2019.0675441281503,2019.026833996531,2018.9853076216709,2018.9429650035709,2018.8998061422308,2018.8558310376491,2018.8110396898273,2018.7654320987656,2018.7190082644627,2018.6717681869195,2018.6237118661361,2018.5748393021117,2018.5251504948474,2018.4746454443425,2018.4233241505967,2018.3711866136109,2018.3182328333842,2018.2644628099174,2018.2098765432099,2018.154474033262,2018.0982552800733,2018.0412202836446,2017.983369043975,2017.9247015610651,2017.8652178349146,2017.804917865524,2017.7438016528927,2017.6818691970207,2017.6191204979084,2017.5555555555557,2017.4911743699624,2017.4259769411283,2017.3599632690541,2017.2931333537394,2017.2254871951841,2017.1570247933882,2017.0877461483522,2017.0176512600756,2016.9467401285583,2016.8750127538005,2016.8024691358023,2016.7291092745636,2016.6549331700846,2016.5799408223652,2016.504132231405,2016.4275073972044,2016.3500663197633,2016.2718089990817,2016.1927354351596,2016.1128456279973,2016.0321395775941,2015.9506172839506,2015.8682787470666,2015.7851239669421,2015.7011529435772,2015.6163656769718,2015.5307621671259,2015.4443424140393,2015.3571064177127,2015.2690541781453,2015.1801856953373,2015.090500969289,2015],"y":[10291442,10301943.102214897,10312349.493248593,10322661.173101101,10332878.141772414,10343000.399262531,10353027.945571456,10362960.780699186,10372798.904645722,10382542.317411061,10392191.018995212,10401745.009398164,10411204.288619924,10420568.856660493,10429838.713519862,10439013.859198039,10448094.293695021,10457080.017010812,10465971.029145405,10474767.330098806,10483468.919871014,10492075.798462026,10500587.965871844,10509005.422100469,10517328.167147899,10525556.201014135,10533689.523699179,10541728.135203028,10549672.035525681,10557521.224667141,10565275.702627409,10572935.469406478,10580500.525004355,10587970.869421043,10595346.502656531,10602627.424710825,10609813.635583928,10616905.135275837,10623901.923786547,10630804.001116065,10637611.367264394,10644324.022231525,10650941.966017459,10657465.198622203,10663893.720045753,10670227.530288106,10676466.629349265,10682611.017229233,10688660.693928005,10694615.659445584,10700475.913781967,10706241.456937158,10711912.288911154,10717488.409703955,10722969.819315564,10728356.517745979,10733648.504995197,10738845.781063223,10743948.345950054,10748956.199655693,10753869.342180137,10758687.773523383,10763411.493685439,10768040.502666302,10772574.800465968,10777014.387084439,10781359.262521718,10785609.426777802,10789764.879852694,10793825.621746391,10797791.652458893,10801662.971990202,10805439.580340315,10809121.477509236,10812708.663496962,10816201.138303496,10819598.901928831,10822901.954372976,10826110.295635924,10829223.92571768,10832242.844618242,10835167.052337609,10837996.548875783,10840731.334232762,10843371.408408549,10845916.771403139,10848367.423216537,10850723.363848738,10852984.593299747,10855151.111569563,10857222.918658182,10859200.014565609,10861082.399291843,10862870.07283688,10864563.035200724,10866161.286383376,10867664.826384833,10869073.655205093,10870387.772844162,10871607.179302035],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Number of Natural Gas Consumers in California","yaxis":{"domain":[0,1],"automargin":true,"title":"Number of Consumers"},"xaxis":{"domain":[0,1],"automargin":true,"title":"Source: US energy information administration"},"legend":{"x":0.029999999999999999,"y":1},"annotations":[{"text":"Breaking <br /> Point","y_ref":"y","x_ref":"x","x":2002,"y":11185638.299999999,"showarrow":false},{"text":"Trend Segment I","y_ref":"y","x_ref":"x","x":1995,"y":10195372.149999999,"showarrow":false},{"text":"Trend Segment II","y_ref":"y","x_ref":"x","x":2021,"y":10109296.800000001,"showarrow":false}],"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[7904858,8113034,8313776,8497848,8634774,8680613,8726187,8790733,8865541,8969308,9060473,9181928,9331206,9370797,9603122,9726642,9803311,9957412,10124433,10329224,10439220,10515162,10510950,10542584,10625190,10681916,10754908,10781720,10969597,10916368,11004853,11025789,11112094,11186350,11232552,11280329,11359812,11428636],"type":"scatter","mode":"lines","name":"Actual","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(243, 158, 182, 0.2)","x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2034,2034,2033,2032,2031,2030,2029,2028,2027,2026,2025],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"rgba(243, 158, 182, 0.05)"},"name":"95% Predication <br /> Interval","y":[11319958.450164588,11378738.381003117,11437351.548088063,11495805.174432991,11554106.502527181,11612262.72846292,11670280.945508838,11728168.096996685,11785930.938090432,11843576.005793301,11843576.005793301,12219992.230323801,12155513.409736507,12091152.362540098,12026915.625737786,11962809.954493541,11898842.29213912,11835019.731943151,11771349.469997924,11707838.748792706,11644494.791341076],"marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2025,2026,2027,2028,2029,2030,2031,2032,2033,2034],"y":[11482226.620752832,11543288.564897912,11604350.509042993,11665412.453188071,11726474.397333151,11787536.34147823,11848598.285623312,11909660.229768392,11970722.17391347,12031784.118058551],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dot"},"name":"Forecast","marker":{"color":"rgba(44,160,44,1)","line":{"color":"rgba(44,160,44,1)"}},"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020,2021,2022,2023,2024],"y":[8005103.5635031192,8121249.7543023266,8237395.945101534,8353542.1359007414,8469688.3266999498,8585834.5174991563,8701980.7082983628,8818126.8990975711,8934273.0898967795,9050419.280695986,9166565.4714951925,9282711.6622944009,9398857.8530936092,9515004.0438928157,9631150.2346920222,9747296.4254912306,9863442.6162904389,9979588.8070896454,10095734.997888852,10211881.18868806,10328027.379487269,10444173.570286475,10505235.514431555,10566297.458576635,10627359.402721716,10688421.346866794,10749483.291011874,10810545.235156953,10871607.179302035,10932669.123447113,10993731.067592192,11054793.011737274,11115854.955882354,11176916.900027433,11237978.844172511,11299040.788317593,11360102.732462673,11421164.676607752],"type":"scatter","mode":"lines","line":{"color":"rgba(243, 158, 182, 1)","dash":"dash"},"name":"Fitted Trend","marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2008],"y":[10515162],"type":"scatter","mode":"markers","showlegend":false,"name":"Breaking Point","marker":{"color":"red","line":{"color":"rgba(148,103,189,1)"}},"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"line":{"color":"rgba(148,103,189,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2003.7,2003.7692317110505,2003.8379369452095,2003.9061157024794,2003.9737679828588,2004.0408937863485,2004.1074931129479,2004.1735659626568,2004.2391123354762,2004.3041322314048,2004.3686256504438,2004.4325925925925,2004.496033057851,2004.5589470462203,2004.621334557698,2004.6831955922867,2004.7445301499845,2004.8053382307928,2004.8656198347105,2004.9253749617387,2004.9846036118763,2005.0433057851239,2005.1014814814816,2005.1591307009489,2005.2162534435261,2005.272849709213,2005.3289194980102,2005.3844628099175,2005.4394796449342,2005.4939700030607,2005.5479338842979,2005.601371288644,2005.6542822161,2005.7066666666667,2005.758524640343,2005.8098561371287,2005.8606611570247,2005.9109397000309,2005.9606917661463,2006.0099173553715,2006.0586164677072,2006.1067891031528,2006.1544352617079,2006.2015549433731,2006.2481481481484,2006.2942148760333,2006.3397551270275,2006.3847689011327,2006.429256198347,2006.4732170186714,2006.5166513621061,2006.55955922865,2006.6019406183041,2006.643795531068,2006.685123966942,2006.7259259259258,2006.7662014080197,2006.8059504132229,2006.8451729415365,2006.8838689929598,2006.922038567493,2006.959681665136,2006.9967982858893,2007.033388429752,2007.0694520967247,2007.1049892868073,2007.1399999999999,2007.1744842363025,2007.2084419957146,2007.2418732782369,2007.274778083869,2007.307156412611,2007.3390082644628,2007.3703336394244,2007.4011325374961,2007.4314049586778,2007.4611509029692,2007.4903703703703,2007.5190633608813,2007.5472298745026,2007.5748699112337,2007.6019834710744,2007.6285705540254,2007.6546311600857,2007.6801652892561,2007.7051729415366,2007.7296541169269,2007.753608815427,2007.777037037037,2007.799938781757,2007.8223140495868,2007.8441628405267,2007.8654851545762,2007.8862809917355,2007.9065503520048,2007.9262932353843,2007.9455096418733,2007.9641995714724,2007.9823630241813,2008],"y":[11175774.539999999,11173064.956885217,11170274.490692377,11167403.141421488,11164450.909072543,11161417.793645546,11158303.795140496,11155108.913557392,11151833.148896234,11148476.501157023,11145038.970339762,11141520.556444444,11137921.259471072,11134241.079419652,11130480.016290173,11126638.070082644,11122715.24079706,11118711.528433423,11114626.932991734,11110461.454471992,11106215.092874195,11101887.848198345,11097479.720444445,11092990.709612485,11088420.815702477,11083770.038714414,11079038.378648302,11074225.835504133,11069332.409281909,11064358.099981634,11059302.907603307,11054166.832146924,11048949.873612488,11043652.032,11038273.307309458,11032813.699540863,11027273.208694216,11021651.834769513,11015949.577766757,11010166.43768595,11004302.414527088,10998357.508290175,10992331.718975207,10986225.046582185,10980037.491111111,10973769.052561982,10967419.730934802,10960989.526229568,10954478.43844628,10947886.467584938,10941213.613645546,10934459.876628099,10927625.256532598,10920709.753359044,10913713.367107438,10906636.097777778,10899477.945370063,10892238.909884298,10884918.991320476,10877518.189678604,10870036.504958676,10862473.937160697,10854830.486284664,10847106.152330577,10839300.935298439,10831414.835188245,10823447.852,10815399.985733703,10807271.236389346,10799061.603966942,10790771.088466484,10782399.689887971,10773947.408231404,10765414.243496787,10756800.195684113,10748105.264793389,10739329.450824611,10730472.753777778,10721535.173652891,10712516.710449953,10703417.364168962,10694237.134809919,10684976.022372819,10675634.026857667,10666211.148264462,10656707.386593204,10647122.741843894,10637457.214016527,10627710.80311111,10617883.509127639,10607975.332066115,10597986.271926539,10587916.328708908,10577765.502413223,10567533.793039486,10557221.200587695,10546827.725057852,10536353.366449954,10525798.124764005,10515162],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"marker":{"color":"rgba(140,86,75,1)","line":{"color":"rgba(140,86,75,1)"}},"error_y":{"color":"rgba(140,86,75,1)"},"error_x":{"color":"rgba(140,86,75,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1995.7,1995.8565264473136,1996.0101874219074,1996.1609829237821,1996.3089129529362,1996.4539775093713,1996.5961765930861,1996.7355102040819,1996.8719783423576,1997.0055810079134,1997.1363182007497,1997.2641899208661,1997.389196168263,1997.5113369429403,1997.630612244898,1997.7470220741359,1997.8605664306542,1997.9712453144525,1998.0790587255308,1998.1840066638899,1998.286089129529,1998.3853061224488,1998.481657642649,1998.5751436901289,1998.6657642648897,1998.7535193669305,1998.8384089962515,1998.9204331528529,1998.9995918367347,1999.0758850478967,1999.1493127863389,1999.2198750520615,1999.2875718450646,1999.3524031653478,1999.4143690129113,1999.4734693877551,1999.5297042898792,1999.5830737192837,1999.6335776759684,1999.6812161599332,1999.7259891711788,1999.7678967097042,1999.8069387755104,1999.8431153685963,1999.876426488963,1999.9068721366098,1999.9344523115369,1999.9591670137443,1999.981016243232,2000],"y":[10106716.739999998,10104104.430721056,10101097.810607558,10097696.879659506,10093901.637876894,10089712.085259726,10085128.221808,10080150.047521718,10074777.562400877,10069010.76644548,10062849.659655524,10056294.242031014,10049344.513571946,10042000.474278321,10034262.124150138,10026129.4631874,10017602.491390103,10008681.208758252,9999365.6152918395,9989655.7109908722,9979551.4958553463,9969052.9698852655,9958160.1330806278,9946872.9854414314,9935191.5269676801,9923115.7576593701,9910645.6775165014,9897781.2865390778,9884522.5847270973,9870869.57208056,9856822.2485994622,9842380.6142838113,9827544.6691336036,9812314.4131488372,9796689.8463295139,9780670.968675632,9764257.7801871952,9747450.2808642015,9730248.4707066491,9712652.3497145399,9694661.9178878739,9676277.1752266511,9657498.1217308715,9638324.757400535,9618757.0822356418,9598795.0962361898,9578438.7994021829,9557688.1917336173,9536543.2732304949,9515004.0438928157],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"marker":{"color":"rgba(227,119,194,1)","line":{"color":"rgba(227,119,194,1)"}},"error_y":{"color":"rgba(227,119,194,1)"},"error_x":{"color":"rgba(227,119,194,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[2015,2015.090500969289,2015.1801856953373,2015.2690541781453,2015.3571064177127,2015.4443424140393,2015.5307621671259,2015.6163656769718,2015.7011529435772,2015.7851239669421,2015.8682787470666,2015.9506172839506,2016.0321395775941,2016.1128456279973,2016.1927354351596,2016.2718089990817,2016.3500663197633,2016.4275073972044,2016.504132231405,2016.5799408223652,2016.6549331700846,2016.7291092745636,2016.8024691358023,2016.8750127538005,2016.9467401285583,2017.0176512600756,2017.0877461483522,2017.1570247933882,2017.2254871951841,2017.2931333537394,2017.3599632690541,2017.4259769411283,2017.4911743699624,2017.5555555555557,2017.6191204979084,2017.6818691970207,2017.7438016528927,2017.804917865524,2017.8652178349146,2017.9247015610651,2017.983369043975,2018.0412202836446,2018.0982552800733,2018.154474033262,2018.2098765432099,2018.2644628099174,2018.3182328333842,2018.3711866136109,2018.4233241505967,2018.4746454443425,2018.5251504948474,2018.5748393021117,2018.6237118661361,2018.6717681869195,2018.7190082644627,2018.7654320987656,2018.8110396898273,2018.8558310376491,2018.8998061422308,2018.9429650035709,2018.9853076216709,2019.026833996531,2019.0675441281503,2019.1074380165287,2019.1465156616673,2019.1847770635652,2019.2222222222224,2019.2588511376389,2019.2946638098153,2019.3296602387513,2019.3638404244462,2019.3972043669014,2019.4297520661157,2019.4614835220896,2019.4923987348227,2019.5224977043158,2019.551780430568,2019.5802469135804,2019.6078971533516,2019.6347311498828,2019.6607489031733,2019.6859504132228,2019.7103356800324,2019.7339047036014,2019.7566574839304,2019.7785940210181,2019.7997143148662,2019.8200183654728,2019.8395061728393,2019.8581777369659,2019.8760330578511,2019.8930721354966,2019.9092949699011,2019.9247015610654,2019.9392919089889,2019.953066013672,2019.9660238751148,2019.9781654933167,2019.9894908682791,2020],"y":[10871607.179302035,10870387.772844162,10869073.655205093,10867664.826384833,10866161.286383376,10864563.035200724,10862870.07283688,10861082.399291843,10859200.014565609,10857222.918658182,10855151.111569563,10852984.593299747,10850723.363848738,10848367.423216537,10845916.771403139,10843371.408408549,10840731.334232762,10837996.548875783,10835167.052337609,10832242.844618242,10829223.92571768,10826110.295635924,10822901.954372976,10819598.901928831,10816201.138303496,10812708.663496962,10809121.477509236,10805439.580340315,10801662.971990202,10797791.652458893,10793825.621746391,10789764.879852694,10785609.426777802,10781359.262521718,10777014.387084439,10772574.800465968,10768040.502666302,10763411.493685439,10758687.773523383,10753869.342180137,10748956.199655693,10743948.345950054,10738845.781063223,10733648.504995197,10728356.517745979,10722969.819315564,10717488.409703955,10711912.288911154,10706241.456937158,10700475.913781967,10694615.659445584,10688660.693928005,10682611.017229233,10676466.629349265,10670227.530288106,10663893.720045753,10657465.198622203,10650941.966017459,10644324.022231525,10637611.367264394,10630804.001116065,10623901.923786547,10616905.135275837,10609813.635583928,10602627.424710825,10595346.502656531,10587970.869421043,10580500.525004355,10572935.469406478,10565275.702627409,10557521.224667141,10549672.035525681,10541728.135203028,10533689.523699179,10525556.201014135,10517328.167147899,10509005.422100469,10500587.965871844,10492075.798462026,10483468.919871014,10474767.330098806,10465971.029145405,10457080.017010812,10448094.293695021,10439013.859198039,10429838.713519862,10420568.856660493,10411204.288619924,10401745.009398164,10392191.018995212,10382542.317411061,10372798.904645722,10362960.780699186,10353027.945571456,10343000.399262531,10332878.141772414,10322661.173101101,10312349.493248593,10301943.102214897,10291442],"type":"scatter","mode":"lines","line":{"color":"black","width":0.90000000000000002},"name":"","showlegend":false,"marker":{"color":"rgba(127,127,127,1)","line":{"color":"rgba(127,127,127,1)"}},"error_y":{"color":"rgba(127,127,127,1)"},"error_x":{"color":"rgba(127,127,127,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>