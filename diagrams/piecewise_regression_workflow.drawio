<mxfile host="app.diagrams.net" modified="2025-01-01T00:00:00.000Z" agent="Claude Code" version="22.1.0" type="device">
  <diagram name="Page-1" id="piecewise-regression">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Input Node -->
        <mxCell id="node1" value="Time Series&#xa;Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#0072B5;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="160" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Prepare Data -->
        <mxCell id="node2" value="Prepare Data&#xa;Define knot range" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="210" y="160" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- Loop -->
        <mxCell id="node3" value="Loop&#xa;k=0 to max_knots" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="400" y="160" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- Generate Candidates -->
        <mxCell id="node4" value="Generate&#xa;Candidates" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="590" y="160" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Fit Models -->
        <mxCell id="node5" value="Fit Models&#xa;Calculate RSS" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="760" y="160" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Compute BIC -->
        <mxCell id="node6" value="Compute BIC&#xa;n·log(RSS/n) + k·log(n)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff4e1;strokeColor=#d79b00;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="930" y="160" width="160" height="80" as="geometry" />
        </mxCell>

        <!-- Keep Best -->
        <mxCell id="node7" value="Keep Best&#xa;for k knots" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="1140" y="160" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Decision Diamond -->
        <mxCell id="node8" value="More&#xa;k values?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1160" y="40" width="80" height="80" as="geometry" />
        </mxCell>

        <!-- Select Model -->
        <mxCell id="node9" value="Select Model&#xa;with Lowest BIC" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe1e1;strokeColor=#b85450;fontSize=13;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1140" y="280" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- Output -->
        <mxCell id="node10" value="Output&#xa;Knots &amp; Fitted Values" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1f5ff;strokeColor=#0072B5;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1140" y="410" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arrow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node1" target="node2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node2" target="node3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node3" target="node4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node4" target="node5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node5" target="node6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node6" target="node7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node7" target="node8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Yes arrow back to Loop -->
        <mxCell id="arrow8" value="Yes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="node8" target="node3">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="470" y="80" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- No arrow to Select -->
        <mxCell id="arrow9" value="No" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="node8" target="node9">
          <mxGeometry x="0.2" y="-10" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="node9" target="node10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
